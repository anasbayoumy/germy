### Germy Auth Service - Comprehensive HTTP Tests
### Test Environment: http://localhost:3001

### Variables
@baseUrl = http://localhost:3001
@adminEmail = admin@company.com
@userEmail = user@company.com
@platformAdminEmail = platform@admin.com
@password = TestPassword123!
@companyId = 550e8400-e29b-41d4-a716-446655440000
@userId = 550e8400-e29b-41d4-a716-446655440001
@adminId = 550e8400-e29b-41d4-a716-446655440002

### ===========================================
### 1. HEALTH CHECK
### ===========================================

GET {{baseUrl}}/health
Content-Type: application/json

### ===========================================
### 2. PLATFORM ADMIN REGISTRATION & LOGIN
### ===========================================

### Register Platform Admin
POST {{baseUrl}}/api/auth/register/platform-admin
Content-Type: application/json

{
  "email": "{{platformAdminEmail}}",
  "password": "{{password}}",
  "firstName": "Platform",
  "lastName": "Admin",
  "phone": "+1234567890"
}

### Login Platform Admin
POST {{baseUrl}}/api/auth/login/platform-admin
Content-Type: application/json

{
  "email": "{{platformAdminEmail}}",
  "password": "{{password}}"
}

### ===========================================
### 3. COMPANY REGISTRATION
### ===========================================

### Register Company (Platform Admin)
POST {{baseUrl}}/api/platform/companies
Content-Type: application/json
Authorization: Bearer {{platformAdminToken}}

{
  "name": "Test Company Inc",
  "domain": "testcompany.com",
  "industry": "Technology",
  "size": "50-200",
  "address": "123 Tech Street, Silicon Valley, CA 94000",
  "phone": "+1-555-0123",
  "website": "https://testcompany.com",
  "subscriptionPlan": "premium",
  "billingEmail": "billing@testcompany.com"
}

### ===========================================
### 4. COMPANY SUPER ADMIN REGISTRATION
### ===========================================

### Register Company Super Admin
POST {{baseUrl}}/api/auth/register/company-super-admin
Content-Type: application/json

{
  "email": "{{adminEmail}}",
  "password": "{{password}}",
  "firstName": "Company",
  "lastName": "Super Admin",
  "phone": "+1234567891",
  "companyId": "{{companyId}}",
  "position": "CTO",
  "department": "Engineering"
}

### Login Company Super Admin
POST {{baseUrl}}/api/auth/login/admin
Content-Type: application/json

{
  "email": "{{adminEmail}}",
  "password": "{{password}}"
}

### ===========================================
### 5. COMPANY ADMIN REGISTRATION
### ===========================================

### Register Company Admin
POST {{baseUrl}}/api/auth/register/company-admin
Content-Type: application/json

{
  "email": "admin2@company.com",
  "password": "{{password}}",
  "firstName": "Company",
  "lastName": "Admin",
  "phone": "+1234567892",
  "companyId": "{{companyId}}",
  "position": "HR Manager",
  "department": "Human Resources"
}

### ===========================================
### 6. EMPLOYEE REGISTRATION
### ===========================================

### Register Employee
POST {{baseUrl}}/api/auth/register/employee
Content-Type: application/json

{
  "email": "{{userEmail}}",
  "password": "{{password}}",
  "firstName": "John",
  "lastName": "Doe",
  "phone": "+1234567893",
  "companyId": "{{companyId}}",
  "employeeId": "EMP001",
  "position": "Software Developer",
  "department": "Engineering",
  "hireDate": "2024-01-15T00:00:00Z",
  "workMode": "hybrid",
  "hybridRemoteDays": 3,
  "preferredRemoteDays": ["monday", "wednesday", "friday"],
  "homeAddress": "456 Home Street, Remote City, RC 12345",
  "homeLatitude": 37.7749,
  "homeLongitude": -122.4194,
  "homeGeofenceRadius": 100
}

### ===========================================
### 7. USER LOGIN TESTS
### ===========================================

### Login Employee
POST {{baseUrl}}/api/auth/login/user
Content-Type: application/json

{
  "email": "{{userEmail}}",
  "password": "{{password}}"
}

### Login Admin
POST {{baseUrl}}/api/auth/login/admin
Content-Type: application/json

{
  "email": "{{adminEmail}}",
  "password": "{{password}}"
}

### ===========================================
### 8. FACE ENCODING TESTS
### ===========================================

### Create Face Encoding (Employee)
POST {{baseUrl}}/api/face-encoding/{{userId}}
Content-Type: application/json
Authorization: Bearer {{userToken}}

{
  "photo": "data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/2wBDAAYEBQYFBAYGBQYHBwYIChAKCgkJChQODwwQFxQYGBcUFhYaHSUfGhsjHBYWICwgIyYnKSopGR8tMC0oMCUoKSj/2wBDAQcHBwoIChMKChMoGhYaKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCj/wAARCAABAAEDASIAAhEBAxEB/8QAFQABAQAAAAAAAAAAAAAAAAAAAAv/xAAUEAEAAAAAAAAAAAAAAAAAAAAA/8QAFQEBAQAAAAAAAAAAAAAAAAAAAAX/xAAUEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwCdABmX/9k=",
  "metadata": {
    "deviceInfo": "iPhone 14 Pro",
    "lighting": "good",
    "angle": "front"
  }
}

### Get Face Encoding Status
GET {{baseUrl}}/api/face-encoding/{{userId}}/status
Authorization: Bearer {{userToken}}

### Get Expiring Face Encodings (Admin)
GET {{baseUrl}}/api/face-encoding/expiring?days=7
Authorization: Bearer {{adminToken}}

### ===========================================
### 9. APPROVAL WORKFLOW TESTS
### ===========================================

### Create Approval Request (Admin for new user)
POST {{baseUrl}}/api/approvals/requests
Content-Type: application/json
Authorization: Bearer {{adminToken}}

{
  "userId": "{{userId}}",
  "companyId": "{{companyId}}",
  "requestedRole": "user",
  "reason": "New employee onboarding"
}

### Get Pending Approval Requests (Admin)
GET {{baseUrl}}/api/approvals/pending?page=1&limit=10
Authorization: Bearer {{adminToken}}

### Approve User
POST {{baseUrl}}/api/approvals/requests/{{requestId}}/approve
Content-Type: application/json
Authorization: Bearer {{adminToken}}

{
  "reviewNotes": "Approved after background check"
}

### Reject User
POST {{baseUrl}}/api/approvals/requests/{{requestId}}/reject
Content-Type: application/json
Authorization: Bearer {{adminToken}}

{
  "reason": "Incomplete documentation"
}

### Get Approval History
GET {{baseUrl}}/api/approvals/history/{{userId}}?page=1&limit=10
Authorization: Bearer {{adminToken}}

### ===========================================
### 10. PASSWORD RESET TESTS
### ===========================================

### Request Password Reset
POST {{baseUrl}}/api/auth/forgot-password
Content-Type: application/json

{
  "email": "{{userEmail}}"
}

### Reset Password
POST {{baseUrl}}/api/auth/reset-password
Content-Type: application/json

{
  "token": "{{resetToken}}",
  "newPassword": "NewPassword123!"
}

### ===========================================
### 11. TOKEN VALIDATION TESTS
### ===========================================

### Validate Token
GET {{baseUrl}}/api/auth/validate
Authorization: Bearer {{userToken}}

### Refresh Token
POST {{baseUrl}}/api/auth/refresh
Content-Type: application/json
Authorization: Bearer {{userToken}}

### Logout
POST {{baseUrl}}/api/auth/logout
Content-Type: application/json
Authorization: Bearer {{userToken}}

### ===========================================
### 12. ERROR SCENARIOS
### ===========================================

### Invalid Login Credentials
POST {{baseUrl}}/api/auth/login/user
Content-Type: application/json

{
  "email": "{{userEmail}}",
  "password": "WrongPassword"
}

### Unauthorized Access
GET {{baseUrl}}/api/approvals/pending
Authorization: Bearer {{userToken}}

### Invalid Token
GET {{baseUrl}}/api/auth/validate
Authorization: Bearer invalid_token

### Missing Required Fields
POST {{baseUrl}}/api/auth/register/employee
Content-Type: application/json

{
  "email": "{{userEmail}}",
  "password": "{{password}}"
  // Missing required fields
}

### ===========================================
### 13. ROLE-BASED ACCESS TESTS
### ===========================================

### User trying to access admin endpoints
GET {{baseUrl}}/api/approvals/pending
Authorization: Bearer {{userToken}}

### Admin accessing platform admin endpoints
GET {{baseUrl}}/api/platform/companies
Authorization: Bearer {{adminToken}}

### Platform admin accessing all endpoints
GET {{baseUrl}}/api/platform/companies
Authorization: Bearer {{platformAdminToken}}

GET {{baseUrl}}/api/approvals/pending
Authorization: Bearer {{platformAdminToken}}

### ===========================================
### 14. WORK MODE MANAGEMENT TESTS
### ===========================================

### Update User Work Mode (Admin)
PUT {{baseUrl}}/api/users/{{userId}}/work-mode
Content-Type: application/json
Authorization: Bearer {{adminToken}}

{
  "workMode": "remote",
  "hybridRemoteDays": 0,
  "preferredRemoteDays": [],
  "homeAddress": "789 Remote Street, Work From Home, WH 54321",
  "homeLatitude": 40.7128,
  "homeLongitude": -74.0060,
  "homeGeofenceRadius": 50
}

### Get User Work Mode
GET {{baseUrl}}/api/users/{{userId}}/work-mode
Authorization: Bearer {{adminToken}}

### ===========================================
### 15. BULK OPERATIONS TESTS
### ===========================================

### Bulk User Registration (Admin)
POST {{baseUrl}}/api/users/bulk-register
Content-Type: application/json
Authorization: Bearer {{adminToken}}

{
  "users": [
    {
      "email": "user1@company.com",
      "firstName": "User",
      "lastName": "One",
      "employeeId": "EMP002",
      "position": "Developer",
      "department": "Engineering"
    },
    {
      "email": "user2@company.com",
      "firstName": "User",
      "lastName": "Two",
      "employeeId": "EMP003",
      "position": "Designer",
      "department": "Design"
    }
  ]
}

### Bulk Approval (Admin)
POST {{baseUrl}}/api/approvals/bulk-approve
Content-Type: application/json
Authorization: Bearer {{adminToken}}

{
  "requestIds": ["{{requestId1}}", "{{requestId2}}"],
  "reviewNotes": "Bulk approval after team review"
}
